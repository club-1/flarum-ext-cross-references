{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@club-1/flarum-ext-cross-references/./src/forum/components/DiscussionLink.js","webpack://@club-1/flarum-ext-cross-references/./src/forum/components/DiscussionReferencedPost.js","webpack://@club-1/flarum-ext-cross-references/./src/forum/index.ts","webpack://@club-1/flarum-ext-cross-references/external root \"flarum.core.compat['common/Component']\"","webpack://@club-1/flarum-ext-cross-references/external root \"flarum.core.compat['common/components/Link']\"","webpack://@club-1/flarum-ext-cross-references/external root \"flarum.core.compat['common/extend']\"","webpack://@club-1/flarum-ext-cross-references/external root \"flarum.core.compat['forum/app']\"","webpack://@club-1/flarum-ext-cross-references/external root \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@club-1/flarum-ext-cross-references/external root \"flarum.core.compat['forum/components/EventPost']\"","webpack://@club-1/flarum-ext-cross-references/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@club-1/flarum-ext-cross-references/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@club-1/flarum-ext-cross-references/webpack/bootstrap","webpack://@club-1/flarum-ext-cross-references/webpack/runtime/compat get default export","webpack://@club-1/flarum-ext-cross-references/webpack/runtime/define property getters","webpack://@club-1/flarum-ext-cross-references/webpack/runtime/hasOwnProperty shorthand","webpack://@club-1/flarum-ext-cross-references/webpack/runtime/make namespace object"],"sourcesContent":["/*\n * This file is part of club-1/flarum-ext-cross-references.\n *\n * Copyright (c) 2022 Nicolas Peugnet <nicolas@club1.fr>.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport app from 'flarum/forum/app';\nimport Link from 'flarum/common/components/Link';\nimport Component from 'flarum/common/Component';\n\n\nexport default class DiscussionLink extends Link {\n  view() {\n    const discussion = this.attrs.discussion;\n    const href = this.attrs.href;\n    const showId = this.attrs.showId;\n    const isComment = href && /\\/d\\/[^\\/]+\\/[0-9]+/.test(href);\n    return (\n      <Link\n        href={href ? href : app.route('discussion', {id: discussion.id()})}\n        class=\"DiscussionLink\"\n      >\n        {\n          discussion.title()\n        } {\n          showId && <DiscussionId discussionId={discussion.id()} />\n        } {\n          isComment && <DiscussionComment/>\n        }\n      </Link>\n    );\n  }\n}\n\nclass DiscussionId extends Component {\n  view() {\n    return <span class=\"DiscussionId\">#{this.attrs.discussionId}</span>\n  }\n}\n\nclass DiscussionComment extends Component {\n  view() {\n    return <span class=\"DiscussionComment\">\n      ({app.translator.trans('club-1-cross-references.forum.comment')})\n    </span>\n  }\n}\n","/*\n * This file is part of club-1/flarum-ext-cross-references.\n *\n * Copyright (c) 2022 Nicolas Peugnet <nicolas@club1.fr>.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport app from 'flarum/forum/app';\nimport EventPost from 'flarum/forum/components/EventPost';\nimport DiscussionLink from './DiscussionLink';\n\n\nexport default class DiscussionReferencedPost extends EventPost {\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n\n    const sourceId = attrs.post.content()[0];\n    attrs.source = app.store.getById('discussions', sourceId);\n  }\n  icon() {\n    return 'fas fa-reply';\n  }\n\n  descriptionKey() {\n    return 'club-1-cross-references.forum.post_stream.discussion_referenced_text';\n  }\n\n  descriptionData() {\n    return {\n      source: <DiscussionLink discussion={this.attrs.source} />\n    }\n  }\n}\n","/*\n * This file is part of club-1/flarum-ext-cross-references.\n *\n * Copyright (c) 2022 Nicolas Peugnet <nicolas@club1.fr>.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { extend, override } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport CommentPost from 'flarum/forum/components/CommentPost';\nimport DiscussionLink from './components/DiscussionLink';\nimport DiscussionReferencedPost from './components/DiscussionReferencedPost';\n\napp.initializers.add('club-1/flarum-ext-cross-references', () => {\n  app.postComponents.discussionReferenced = DiscussionReferencedPost;\n});\n\nextend(CommentPost.prototype, 'content', (original) => {\n  const postBody = original[1];\n  const content = postBody.children[0];\n  const el = document.createElement('p');\n  el.innerHTML = content.children;\n  el.querySelectorAll('a').forEach((a: HTMLAnchorElement) => {\n    if (a.text !== a.href) {\n      return;\n    }\n    if (a.protocol === document.location.protocol && a.host === document.location.host) {\n      const match = a.pathname.match(/\\/d\\/([0-9]+)/);\n      if (match == null) {\n        return;\n      }\n      const discussionId = match[1];\n      const discussion = app.store.getById('discussions', discussionId);\n      m.mount(a, {view: () => m(DiscussionLink, {discussion, href: a.href})});\n    }\n  });\n  content.children = el.innerHTML;\n});\n","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/components/Link'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/CommentPost'];","module.exports = flarum.core.compat['forum/components/EventPost'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["app","Link","Component","DiscussionLink","view","discussion","attrs","href","showId","isComment","test","route","id","title","DiscussionId","discussionId","DiscussionComment","translator","trans","EventPost","DiscussionReferencedPost","initAttrs","sourceId","post","content","source","store","getById","icon","descriptionKey","descriptionData","extend","CommentPost","initializers","add","postComponents","discussionReferenced","prototype","original","postBody","children","el","document","createElement","innerHTML","querySelectorAll","forEach","a","text","protocol","location","host","match","pathname","m","mount","setPrototypeOf","_inheritsLoose","subClass","superClass","Object","create","constructor","_setPrototypeOf","o","p","bind","__proto__"],"sourceRoot":""}